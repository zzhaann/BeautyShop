<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:BeautyShop.Converters"
             x:Class="BeautyShop.Pages.ServicesPage"
             Title="Услуги">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:CartIconConverter x:Key="CartIconConverter" />
            <local:FavoriteIconConverter x:Key="FavoriteIconConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="10">

        <!-- Поиск -->
        <SearchBar Placeholder="Поиск услуги..."
                   x:Name="SearchBar"
                   TextChanged="OnSearchTextChanged"
                   Margin="0,0,0,10" />

        <!-- Список услуг -->
        <CollectionView x:Name="ServicesList" Grid.Row="1" SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="5" Padding="10" BorderColor="LightGray" CornerRadius="15" HasShadow="True">
                        <Grid ColumnDefinitions="Auto, *, Auto" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10">

                            <!-- Картинка услуги -->
                            <Image Source="{Binding Service.ImagePath}" 
                                   WidthRequest="80" HeightRequest="100"
                                   Aspect="AspectFill"
                                   Grid.RowSpan="3" />

                            <!-- Название и цена -->
                            <StackLayout Grid.Column="1" Spacing="2">
                                <Label Text="{Binding Service.Title}" 
                                       FontAttributes="Bold"
                                       FontSize="18" />
                                <Label Text="{Binding Service.Price, StringFormat='Цена: {0} ₸'}" 
                                       FontSize="14"
                                       TextColor="Gray" />
                            </StackLayout>

                            <!-- Корзина и избранное -->
                            <StackLayout Grid.Column="2" Spacing="10" Margin="0, -10 " VerticalOptions="Center">
                                <ImageButton Source="{Binding IsInCart, Converter={StaticResource CartIconConverter}}"
                                             Clicked="OnCartClicked"
                                             WidthRequest="30"
                                             HeightRequest="30"
                                             BackgroundColor="Transparent" />
                                <ImageButton Source="{Binding IsFavorite, Converter={StaticResource FavoriteIconConverter}}"
                                             Clicked="OnFavoriteClicked"
                                             WidthRequest="30"
                                             HeightRequest="30"
                                             BackgroundColor="Transparent" />
                            </StackLayout>

                            <!-- Описание услуги -->
                            <Label Text="{Binding Service.Description}"
                                   FontSize="14"
                                   TextColor="DarkGray"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="2"
                                   Grid.Row="1"
                                   Grid.Column="1"
                                   Grid.ColumnSpan="2" />

                            <!-- Кнопки Отзывов -->
                            <StackLayout Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal" Spacing="10" Margin="0, 10" HorizontalOptions="Center">
                                <Button Text="Оставить отзыв"
                                        BackgroundColor="#c992a1"
                                        TextColor="White"
                                        CornerRadius="10"
                                        Padding="15,5"
                                        WidthRequest="140"
                                        Clicked="OnLeaveReviewClicked"
                                        BindingContext="{Binding}" />
                                <Button Text="Отзывы"
                                        BackgroundColor="#f5eff1"
                                        TextColor="Black"
                                        CornerRadius="10"
                                        Padding="15,5"
                                        WidthRequest="100"
                                        Clicked="OnViewReviewsClicked"
                                        BindingContext="{Binding}" />
                            </StackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>
